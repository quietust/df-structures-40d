<data-definition>
    <enum-type type-name='region_biome_type'>
        <enum-item name='SWAMP'/>
        <enum-item name='DESERT'/>
        <enum-item name='FOREST'/>
        <enum-item name='MOUNTAINS'/>
        <enum-item name='OCEAN'/>
        <enum-item name='LAKE'/>
        <enum-item name='GLACIER'/>
        <enum-item name='TUNDRA'/>
        <enum-item name='GRASSLAND'/>
        <enum-item name='HILLS'/>
    </enum-type>

    <enum-type type-name='region_property_type'>
        <enum-item name='elevation'/>
        <enum-item name='rainfall'/>
        <enum-item name='vegetation'/>
        <enum-item name='temperature'/>
        <enum-item name='evilness'/>
        <enum-item name='drainage'/>
        <enum-item name='volcanism'/>
        <enum-item name='savagery'/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item name='salinity'/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
    </enum-type>

    <enum-type type-name="world_population_type">
        <enum-item name='Animal'/>
        <enum-item name='Vermin'/>
        <enum-item name='Unk2'/>
        <enum-item name='VerminSoil'/>
        <enum-item name='VerminColony'/>
        <enum-item name='Tree'/>
        <enum-item name='Unk6'/>
        <enum-item name='Shrub'/>
    </enum-type>

    <struct-type type-name='world_population_ref'>
        <int16_t name="region_x"/>
        <int16_t name="region_y"/>
        <int16_t name="feature_idx" init-value="-1"/>
        <int32_t/>
        <int32_t name="population_idx"/>
    </struct-type>

    <struct-type type-name='local_population'>
        <enum base-type='int8_t' name='type' type-name='world_population_type'/>

        <compound is-union='true'>
            <int16_t name="race" ref-target='creature_raw'/>
            <int16_t name="plant" ref-target='matgloss_plant'/>
            <int16_t name="tree" ref-target='matgloss_wood'/>
        </compound>

        <int32_t name="quantity"/>
        <bool name="known" comment='in ui.tasks.known_*'/>

        <compound name='population' type-name='world_population_ref'/>
    </struct-type>

    <struct-type type-name='world_population'>
        <enum base-type='int16_t' name='type' type-name='world_population_type'/>

        <compound is-union='true'>
            <int16_t name="race" ref-target='creature_raw'/>
            <int16_t name="plant" ref-target='matgloss_plant'/>
            <int16_t name="tree" ref-target='matgloss_wood'/>
        </compound>

        <int32_t name="count_min" init-value='10000001'/>
        <int32_t name="count_max" init-value='10000001'/>
    </struct-type>

    <struct-type type-name='embark_note'>
        <int8_t name='tile'/>
        <int16_t name='fg_color'/>
        <int16_t name='bg_color'/>
        <stl-string name='name'/>
        <compound name='pos' type-name='coord2d'/>
        <int16_t name='left'/>
        <int16_t name='right'/>
        <int16_t name='top'/>
        <int16_t name='bottom'/>
    </struct-type>

    <struct-type type-name='world_data_unk194' key-field='id' instance-vector='$global.world.world_data.unk194'>
        <static-array count='3'>
            <stl-vector>
                <pointer>
                    <int16_t/>
                    <int16_t/>
                    <int16_t/>
                    <int16_t/>
                    <int8_t/>
                    <int32_t/>
                    <int32_t/>
                </pointer>
            </stl-vector>
        </static-array>
        <int32_t name='id'/>
        <int32_t/>
        <int32_t/>
    </struct-type>

    <struct-type type-name='world_landmass'
                 instance-vector='$global.world.world_data.landmasses'>
        <compound name='name' type-name='language_name'/>
        <code-helper name='describe'>(describe-obj $.name)</code-helper>

        <int32_t name="index"/>
        <int32_t name="area"/>

        <stl-vector name="unk_74"/>
        <stl-vector name="unk_84"/>
    </struct-type>

    <struct-type type-name='world_region' key-field='id' instance-vector='$global.world.world_data.regions'>
        <compound name='name' type-name='language_name'/>
        <code-helper name='describe'>(describe-obj $.name)</code-helper>

        <int32_t name="id"/>
        <enum name='biome_type' type-name='region_biome_type' base-type='int16_t'/>

        <compound name='region_coords' type-name='coord2d_path'/>

        <int32_t name="unk_88"/>
        <int32_t name="unk_8c"/>
        <int32_t name="unk_90"/>
        <int32_t name="unk_94"/>

        <stl-vector name='populations' pointer-type='world_population'/>

        <static-array name='biome_tile_counts' type-name='int32_t' count="51" index-enum='biome_type'/>

        <stl-vector/>
        <stl-vector/>
        <stl-vector/>
        <stl-vector/>
        <stl-vector/>
        <stl-vector/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int16_t/>
        <stl-vector/>
        <int32_t/>
    </struct-type>

    <struct-type type-name='world_river'>
        <compound name='name' type-name='language_name'/>
        <code-helper name='describe'>(describe-obj $.name)</code-helper>

        <compound name='path' type-name='coord2d_path'/>
        <stl-vector name="unk_8c" type-name='int32_t'/>
        <stl-vector name="unk_9c" type-name='int16_t'/>
        <stl-vector name="local_id" type-name='int16_t'/>

        <compound name='end_pos' type-name='coord2d'/>
        <df-flagarray name='flags'/>
    </struct-type>

    <struct-type type-name='world_mountain_peak'>
        <compound name='name' type-name='language_name'/>
        <compound name='pos' type-name='coord2d'/>
        <df-flagarray name='flags'/>
        <int16_t name="height"/>
    </struct-type>

    <enum-type type-name='geo_layer_type' base-type='int16_t'>
        <enum-attr name='flag' type-name='matgloss_stone_flags' use-key-name='true'/>

        <enum-item name='SOIL'/>
        <enum-item name='SEDIMENTARY'/>
        <enum-item name='METAMORPHIC'/>
        <enum-item name='IGNEOUS_EXTRUSIVE'/>
        <enum-item name='IGNEOUS_INTRUSIVE'/>
        <enum-item name='SOIL_OCEAN'/>
        <enum-item name='SOIL_SAND'/>
        <enum-item name='SEDIMENTARY_OCEAN_SHALLOW'/>
        <enum-item name='SEDIMENTARY_OCEAN_DEEP'/>
    </enum-type>

    <struct-type type-name='world_geo_layer'>
        <enum base-type='int16_t' name="type" type-name='geo_layer_type'/>

        <int16_t name="matgloss" ref-target='matgloss_stone'/>

        <code-helper name='describe'>(describe-obj $.matgloss.ref-target)</code-helper>

        <stl-vector name="vein_mat" type-name='int16_t' ref-target='matgloss_stone'/>
        <stl-vector name="vein_nested_in">
            -- Index of the other vein this one is nested in, or -1
            <int16_t refers-to='$$._global.vein_mat[$].ref-target'/>
        </stl-vector>
        <stl-vector name="vein_type">
            <enum base-type='int8_t' type-name='inclusion_type'/>
        </stl-vector>
        <stl-vector name="vein_frequency" type-name='int8_t'/>

        <int16_t name="top_height" comment='negative'/>
        <int16_t name="bottom_height"/>
    </struct-type>

    <struct-type type-name='world_geo_biome' instance-vector='$global.world.world_data.geo_biomes'>
        <int16_t name='unk1'/>
        <int16_t name='index'/>

        <code-helper name='describe'>(fmt "~A geo_layers" $.layers.count)</code-helper>

        <stl-vector name="layers" pointer-type='world_geo_layer'/>
    </struct-type>

    <struct-type type-name='world_region_feature'>
        <int16_t name='feature_idx'/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int8_t/>
        <int32_t/>
        <df-flagarray/>
    </struct-type>

    <struct-type type-name='world_region_details'>
        <static-array count='17' name='biome'>
            <static-array type-name='int8_t' count='17'
                          comment='lower 4 bits: biome 1..9; |=0x30 if fort'/>
        </static-array>
        <static-array count='17' name='elevation'>
            <static-array type-name='int16_t' count='17'/>
        </static-array>

        <static-array count='16'>
            <static-array type-name='uint32_t' count='16'/>
        </static-array>
        <static-array count='17'>
            <static-array count='16'>
                <static-array count='2' type-name='int16_t'/>
            </static-array>
        </static-array>
        <static-array count='16'>
            <static-array count='17'>
                <static-array count='2' type-name='int16_t'/>
            </static-array>
        </static-array>
        <static-array count='16'>
            <static-array type-name='int8_t' count='16'/>
        </static-array>
        <static-array count='16'>
            <static-array type-name='int8_t' count='16'/>
        </static-array>
        <static-array count='16'>
            <static-array type-name='int8_t' count='16'/>
        </static-array>

        <compound name='pos' type-name='coord2d'/>
        <int16_t name='unk12e8'/>
        <int16_t/>
        <int16_t/>
        <int16_t/>
        <int16_t/>

        -- Rivers crossing embark tile edges
        <compound name='rivers_vertical'>
            <static-array name='x_min' count='16'>
                <static-array type-name='int16_t' count='17'/>
            </static-array>
            <static-array name='x_max' count='16'>
                <static-array type-name='int16_t' count='17'/>
            </static-array>
            <static-array name='active' count='16'>
                <static-array type-name='int8_t' count='17'/>
            </static-array>
            <static-array name='local_id' count='16'>
                <static-array type-name='int16_t' count='17'/>
            </static-array>
        </compound>

        <compound name='rivers_horizontal'>
            <static-array name='y_min' count='17'>
                <static-array type-name='int16_t' count='16'/>
            </static-array>
            <static-array name='y_max' count='17'>
                <static-array type-name='int16_t' count='16'/>
            </static-array>
            <static-array name='active' count='17'>
                <static-array type-name='int8_t' count='16'/>
            </static-array>
            <static-array name='local_id' count='17'>
                <static-array type-name='int16_t' count='16'/>
            </static-array>
        </compound>

        <static-array count='16' name='features'>
            <static-array count='16'>
                <stl-vector pointer-type='world_region_feature'/>
            </static-array>
        </static-array>

        <int16_t name='lava_stone' ref-target='matgloss_stone'/>

        <static-array count='16' name='elevation2'>
            <static-array type-name='int16_t' count='16'/>
        </static-array>

        <static-array count='16'>
            <static-array type-name='int32_t' count='16'/>
        </static-array>
    </struct-type>

    <enum-type type-name='region_map_entry_flags'>
        <enum-item name='has_river'/>
        <enum-item name='tile_variant'/>
        <enum-item/>
        <enum-item name='has_site'/>
        <enum-item/>
        <enum-item name='river_up'/>
        <enum-item name='river_down'/>
        <enum-item name='river_right'/>

        <enum-item name='river_left'/>
        <enum-item name='discovered'/>
        <enum-item name='visible'/>
        <enum-item/>
        <enum-item/>
        <enum-item name='is_peak'/>
        <enum-item name='is_lake'/>
        <enum-item name='is_brook'/>

        <enum-item name='has_road'/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
        <enum-item/>
    </enum-type>

    <enum-type type-name='front_type' base-type='uint16_t'>
        <enum-item name='front_none'/>
        <enum-item name='front_warm'/>
        <enum-item name='front_cold'/>
        <enum-item name='front_occluded'/>
    </enum-type>

    <enum-type type-name='cumulus_type' base-type='uint16_t'>
        <enum-item name='cumulus_none'/>
        <enum-item name='cumulus_medium'/>
        <enum-item name='cumulus_multi'/>
        <enum-item name='cumulus_nimbus'/>
    </enum-type>

    <enum-type type-name='stratus_type' base-type='uint16_t'>
        <enum-item name='stratus_none'/>
        <enum-item name='stratus_alto'/>
        <enum-item name='stratus_proper'/>
        <enum-item name='stratus_nimbus'/>
    </enum-type>

    <enum-type type-name='fog_type' base-type='uint16_t'>
        <enum-item name='fog_none'/>
        <enum-item name='fog_mist'/>
        <enum-item name='fog_normal'/>
        <enum-item name='fog_thick'/>
    </enum-type>

    <struct-type type-name='region_map_entry'>
        <int32_t name="unk_0"/>
        <int32_t name='finder_rank' init-value='-1'/>
        <stl-vector name="sites" pointer-type='world_site'/>
        <df-flagarray name='flags' index-enum='region_map_entry_flags'/>
        <int16_t name="elevation" comment='~40 ocean -> ~100 plains -> ~200 mointains'/>
        <int16_t name="rainfall"/>
        <int16_t name="vegetation"/>
        <int16_t name="temperature"/>
        <int16_t name="evilness"/>
        <int16_t name="drainage"/>
        <int16_t name="volcanism"/>
        <int16_t name="savagery"/>
        <int16_t name="air_temp" comment='3'/>
        <int16_t name="air_x" comment='0'/>
        <int16_t name="air_y" comment='0'/>
        <bitfield name='clouds' base-type='uint16_t'>
            <flag-bit name='front' count='2' type-name='front_type'/>
            <flag-bit name='cumulus' count='2' type-name='cumulus_type'/>
            <flag-bit name='cirrus' count='1'/>
            <flag-bit name='stratus' count='2' type-name='stratus_type'/>
            <flag-bit name='fog' count='2' type-name='fog_type'/>
            <flag-bit name='countdown' count='4' comment='A counter for stratus clouds that randomly decreases by 1 or 0 each timer weather is checked there. it does various stratus/fog effects based on the humidity/breezes/etc.'/>
        </bitfield>
        <bitfield name='wind' base-type='uint16_t' comment='blows toward direction in morning'>
            <flag-bit name='north_1'/>
            <flag-bit name='south_1'/>
            <flag-bit name='east_1'/>
            <flag-bit name='west_1'/>
            <flag-bit name='north_2'/>
            <flag-bit name='south_2'/>
            <flag-bit name='east_2'/>
            <flag-bit name='west_2'/>
        </bitfield>
        <int16_t name="snowfall" comment='0-5000'/>
        <int16_t name="salinity"/>
        <compound name='unk_3e' type-name='coord'/>
        <compound name='unk_44' type-name='coord'/>
        <compound name='unk_4a' type-name='coord'/>
        <int32_t name="region_id" ref-target='world_region'/>
        <int32_t name="landmass_id" ref-target='world_landmass'/>
        <int16_t name='geo_index' ref-target='world_geo_biome'/>
    </struct-type>

    <struct-type type-name='entity_claim_mask'>
        <pointer name="map" is-array='true'>
            <pointer is-array='true'>
                <stl-vector name='entities'>
                    <int32_t ref-target='historical_entity'/>
                </stl-vector>
                <stl-vector name='region_masks'>
                    <pointer>
                        <static-array count='16'><static-array count='16' type-name='uint8_t' comment='1  bit per entity'/></static-array>
                    </pointer>
                </stl-vector>
            </pointer>
        </pointer>
        <int16_t name="width"/>
        <int16_t name="height"/>
    </struct-type>

    <struct-type type-name='moving_party'>
        <compound name='pos_g' type-name='coord2d' comment='global block x/y'/>
        <compound name='pos_r' type-name='coord2d' comment='region tile x/y'/>
        <int16_t name='timer'/>
        <int32_t/>
        <stl-vector name='members' type-name='int32_t' ref-target='nemesis_record'/>
        <int32_t name="entity_id" ref-target='historical_entity'/>
        <df-flagarray name='flags'/>
        <compound type-name='coord2d_path' name='path_g' />
        <compound type-name='coord2d_path' name='path_r' />
        <int16_t/>
        <compound name='dest_g' type-name='coord2d' comment='global block x/y'/>
        <compound name='dest_r' type-name='coord2d' comment='region tile x/y'/>
        <int32_t name="region_id" ref-target='world_region'/>
    </struct-type>

    <struct-type type-name='world_data'>
        <compound type-name='language_name' name='name'/>

        <static-array name='gamemode_flags' count='15' type-name='int8_t'/>
        <int32_t name='next_site_id'/>
        <int32_t/>
        <int16_t name='world_width'/>
        <int16_t name='world_height'/>

        <stl-vector name='travel' pointer-type='moving_party'/>

        <compound name='history' type-name='world_history'/>
        <int32_t/>
        <int16_t name='flip_latitude'/>
        <int16_t name='flip_longitude'/>
        <static-array count='3' type-name='int16_t'/>
        <static-array count='3' type-name='int16_t'/>
        <int32_t name='next_unit_chunk_id'/>
        <int16_t name='next_unit_chunk_slot'/>
        <int32_t name='next_art_image_chunk_id'/>
        <int16_t name='next_art_image_chunk_slot'/>
        <compound name='lookups'>
            <int32_t name='width'/>
            <int32_t name='height'/>
            <pointer type-name='uint32_t' is-array='true' comment='(width+1)*(height+1)'/>
            <pointer type-name='uint32_t' is-array='true' comment='(width+1)*(height+1)'/>
            <pointer type-name='uint32_t' is-array='true' comment='width*height'/>
            <pointer type-name='uint8_t' is-array='true' comment='(width+1)*(height+1)'/>
        </compound>

        <compound name='terrain'>
            <stl-vector name='region_details' pointer-type='world_region_details'/>
            <int32_t name='adv_region_x'/>
            <int32_t name='adv_region_y'/>
            <int32_t name='adv_emb_x'/>
            <int32_t name='adv_emb_y'/>
            <int16_t name='unk_x1'/>
            <int16_t name='unk_y1'/>
            <int16_t name='unk_x2'/>
            <int16_t name='unk_y2'/>
        </compound>

        <compound name='constructions'>
            <int16_t name="width"/>
            <int16_t name="height"/>

            <pointer name="map" is-array='true'>
                <pointer is-array='true'>
                    <stl-vector pointer-type='world_construction_square'/>
                </pointer>
            </pointer>

            <stl-vector name="list" pointer-type='world_construction'/>
            <int32_t name="next_id"/>
        </compound>

        <compound name='worldgen_parms' type-name='worldgen_parms'/>

        <stl-string name='version'/>
        <int32_t name='loadversion'/>

        <compound name="entity_claims1" type-name='entity_claim_mask'/>
        <compound name="entity_claims2" type-name='entity_claim_mask'/>

        <stl-vector name="sites" pointer-type='world_site'/>
        <stl-vector name="unk194" pointer-type='world_data_unk194'/>
        <stl-vector name="landmasses" pointer-type='world_landmass'/>
        <stl-vector name="regions" pointer-type='world_region'/>
        <stl-vector name="geo_biomes" pointer-type='world_geo_biome'/>
        <stl-vector name="mountain_peaks" pointer-type='world_mountain_peak'/>
        <stl-vector name="rivers" pointer-type='world_river'/>
        <pointer name="region_map" is-array='true'>
            <pointer is-array='true' type-name='region_map_entry'/>
        </pointer>
        <pointer name='region_map_seeds' is-array='true' type-name='int32_t' comment='2D array, size ceil(width/16) * ceil(height/16)'/>
        <int32_t/>
        <stl-vector name="embark_notes" pointer-type='embark_note'/>
        <stl-vector name='unk_sites' pointer-type='world_site'/>
        <pointer is-array='true' name='feature_map'>
            <pointer is-array='true'>
                <int16_t name='x'/>
                <int16_t name='y'/>
                <pointer name='features'>
                    <static-array name='feature_init' count='16'>
                        <static-array count='16'>
                            <stl-vector pointer-type='feature_init'/>
                        </static-array>
                    </static-array>
                </pointer>
                <pointer name='river_map'>
                    <static-array count='16'>
                        <static-array count='16'>
                            <int16_t name='river_id'/>
                            <int16_t name='path_coord'/>
                        </static-array>
                    </static-array>
                </pointer>
            </pointer>
        </pointer>
        <stl-string name='save_folder_name'/>
        <df-flagarray name='flags'/>
        <stl-vector type-name='int32_t' name='reclaim_sites' ref-target='world_site'/>
        <stl-vector type-name='int32_t' name='reclaim_x'/>
        <stl-vector type-name='int32_t' name='reclaim_y'/>
        <stl-vector type-name='int16_t'/>
        <stl-vector type-name='int16_t'/>
        <int32_t/>
        <int8_t/>
        <int32_t name='unk_tag'/>
        <int8_t name='unk_tag_exceeded'/>
        <int32_t name='unk_tag_increment'/>
        <int32_t/>
        <stl-vector name='worldgen_nomads'/>
        <int32_t name='initial_version'/>
    </struct-type>
</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
